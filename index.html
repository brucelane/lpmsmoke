<!DOCTYPE html>
<html>

<head>
    <title>LPM smoke</title>
    <script type="text/javascript" src="lib/three.min.js"></script>
    <!-- script type="text/javascript" src="lib/jquery-1.9.0.js"></script -->
    <script type="text/javascript" src="lib/stats.min.js"></script>
    <!-- ShaderParticles -->
    <script type="text/javascript" src="lib/ShaderParticles.min.js"></script>
    <style>
        body {
            /* set margin to 0 and overflow to hidden, to go fullscreen */
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>

<!-- Div which will hold the Output -->
<div id="WebGL-output">
</div>

<script type="text/javascript">
// Author: Bruce LANE
// Credit: https://github.com/squarefeet/ShaderParticleEngine
// variables used in init()
        var scene, camera, renderer, stats, stats2, clock;

        // Used in initParticles()
        var emitter, particleGroup;

        // Setup the scene
        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 10000);
            camera.position.z = 80;
            camera.lookAt( scene.position );

            renderer = new THREE.WebGLRenderer();
            renderer.setSize( window.innerWidth, window.innerHeight );
            renderer.setClearColor(0x000000);

            //var ambi = new THREE.AmbientLight(0x181818);
            var ambi = new THREE.AmbientLight(0xf8f8f8);
            scene.add(ambi);

            var spotLight = new THREE.DirectionalLight(0xffffff);
            spotLight.position.set(550, 100, 550);
            spotLight.intensity = 0.6;

            scene.add(spotLight);

            stats = new Stats();
            clock = new THREE.Clock();

            stats.domElement.style.position = 'absolute';
            stats.domElement.style.top = '0';

            document.body.appendChild( renderer.domElement );
            document.body.appendChild( stats.domElement );
        }

        // Create image
        function initImage() {
            // lpm logo
            var lpmTexture = THREE.ImageUtils.loadTexture("assets/lpm.png");

            var lpmMaterial = new THREE.MeshPhongMaterial();
            lpmMaterial.map = lpmTexture;

            var lpmPlane = new THREE.Mesh(
                new THREE.PlaneGeometry(70,30,1,1),
                lpmMaterial
            );
            
            lpmPlane.position.x = 0;
            lpmPlane.position.y = 0; 
            lpmPlane.position.z = -20;
            scene.add( lpmPlane ); 

        }

        // Create particle group and emitter
        function initParticles() {
            var texture = THREE.ImageUtils.loadTexture('assets/smokeparticle.png');
            // texture.magFilter = THREE.LinearMipMapLinearFilter;
            // texture.minFilter = THREE.LinearMipMapLinearFilter;

            particleGroup = new SPE.Group({
                texture: texture,
                maxAge: 5
            });

            emitter = new SPE.Emitter({
                type: 'cube',
                // [OPTIONAL] Base position for the emitter. Can be changed over time.
                position: new THREE.Vector3(0, 6, 50),
                // [OPTIONAL] Particle start position variance.
                positionSpread: new THREE.Vector3(6, 15, 10),
                // [OPTIONAL] Acceleration base vector.
                acceleration: new THREE.Vector3(0, 15, 0),
                // [OPTIONAL] Velocity base vector.
                velocity: new THREE.Vector3(0, 5, 0),
                velocitySpread: new THREE.Vector3(50, 0, 0),
                //particlesPerSecond: 1000,
                particleCount: 10000,
                sizeStart: 10,
                sizeEnd: 0,
                opacityStart: 0.1,
                opacityStartSpread: 0,

                // [OPTIONAL] Particle middle opacity.
                // The opacity value at half a particle's lifecycle.
                // If not specified, it will be set to halfway between the
                // `opacityStart` and `opacityEnd` values.
                opacityMiddle: 0.08,

                // [OPTIONAL] Particle middle opacity variance.
                opacityMiddleSpread: 0.8,
                opacityEnd: 0,
                colorStart: new THREE.Color('black'),
                colorMiddle: new THREE.Color( 'white' ),
                colorEnd: new THREE.Color('black')
            });

            particleGroup.addEmitter( emitter );
            scene.add( particleGroup.mesh );

            //document.querySelector('.numParticles').textContent = 'Total particles: ' + emitter.numParticles;
        }



        function animate() {
            requestAnimationFrame( animate );

            // Using a fixed time-step here to avoid pauses
            render( 0.016 );
            stats.update();
        }


        function render( dt ) {
            particleGroup.tick( dt );
            renderer.render( scene, camera );

            //camera.position.x = Math.sin( Date.now() * 0.0005 ) * 150;
            //camera.position.z = Math.cos( Date.now() * 0.0005 ) * 150;
            camera.lookAt( scene.position );
        }


        window.addEventListener( 'resize', function() {
            var w = window.innerWidth,
                h = window.innerHeight;

            camera.aspect = w / h;
            camera.updateProjectionMatrix();

            renderer.setSize( w, h );
        }, false );

        init();
        initImage();
        initParticles();

        setTimeout(animate, 0);
    // once everything is loaded, we run our Three.js stuff.
    /*$(function () {

        // instanciate stats
        stats = new Stats();
        stats.domElement.style.position = 'absolute';
        stats.domElement.style.top = '0';
        document.body.appendChild( stats.domElement );

        // create a scene, that will hold all our elements such as objects, cameras and lights.
        var scene = new THREE.Scene();

        // create a camera, which defines where we're looking at.
        var camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);

        // create a render and set the size
        var webGLRenderer = new THREE.WebGLRenderer();
        webGLRenderer.setClearColor(0x000000);
        webGLRenderer.setSize(window.innerWidth, window.innerHeight);
        webGLRenderer.shadowMapEnabled = true;

        // position and point the camera to the center of the scene
        camera.position.x = 20;
        camera.position.y = 0;
        camera.position.z = 150;

        camera.lookAt(new THREE.Vector3(0, 0, 0));

        var clock = new THREE.Clock();

        //var ambi = new THREE.AmbientLight(0x181818);
        var ambi = new THREE.AmbientLight(0xf8f8f8);
        scene.add(ambi);

        var spotLight = new THREE.DirectionalLight(0xffffff);
        spotLight.position.set(550, 100, 550);
        spotLight.intensity = 0.6;

        scene.add(spotLight);

        // add the output of the renderer to the html element
        $("#WebGL-output").append(webGLRenderer.domElement);

        // lpm logo
        var lpmTexture = THREE.ImageUtils.loadTexture("assets/lpm.png")

        var lpmMaterial = new THREE.MeshPhongMaterial();
        lpmMaterial.map = lpmTexture;

        var lpmPlane = new THREE.Mesh(
            new THREE.PlaneGeometry(80,40,1,1),
            lpmMaterial
        );
        
        lpmPlane.position.x = 0;
        lpmPlane.position.y = -40; 
        lpmPlane.position.z = 2;
        scene.add( lpmPlane ); 
        //particles
        var smokeParticles = new THREE.Geometry;
        for (var i = 0; i < 20000; i++) {
            var particle = new THREE.Vector3(Math.random() * 64 - 32, Math.random() * 230, Math.random() * 4 );
            smokeParticles.vertices.push(particle);
        }
        var smokeTexture = THREE.ImageUtils.loadTexture('assets/smoke.png');
        var smokeMaterial = new THREE.ParticleBasicMaterial({ map: smokeTexture, opacity: 0.3, transparent: true, blending: THREE.AdditiveBlending, size: 7, color: 0xffffff });

        var smoke = new THREE.ParticleSystem(smokeParticles, smokeMaterial);
        smoke.sortParticles = true;

        smoke.position.x = 8;
        smoke.position.y = -30;
        smoke.position.z = 15;
        scene.add(smoke);

        // call the render function
        render();

        function render() {

            var delta = clock.getDelta();
            //console.log("delta:" + delta);
            var particleCount = smokeParticles.vertices.length;
            while (particleCount--) {
                var particle = smokeParticles.vertices[particleCount];
                particle.x += ( Math.random() - 0.5 )  * 0.08 * particle.y;
                particle.y += delta * 3;
                 
                if (particle.y >= 230) {
            //console.log("delta:" + delta);
                    particle.y = Math.random() * 16;
                    particle.x = Math.random() * 64 - 32;
                    //particle.z = Math.random() * 64 - 16;
                }
            }
            smokeParticles.__dirtyVertices = true;

            webGLRenderer.render(scene, camera);
            // render using requestAnimationFrame
            requestAnimationFrame(render);

        }

    });*/


</script>
</body>
</html>